package com.suneee.oa.service.office;import com.suneee.core.db.IEntityDao;import com.suneee.core.util.UniqueIdUtil;import com.suneee.eas.common.uploader.UploaderHandler;import com.suneee.eas.common.utils.FileUtil;import com.suneee.oa.dao.office.OfficeFileDao;import com.suneee.oa.dto.OfficeFileDto;import com.suneee.ucp.base.service.UcpBaseService;import org.springframework.stereotype.Service;import org.springframework.web.multipart.MultipartFile;import javax.annotation.Resource;/** * @program: eas-parent * @description: office控件service * @author: liuhai * @create: 2018-09-26 15:20 **/@Servicepublic class SysOfficeService extends UcpBaseService<OfficeFileDto>{    @Resource    private OfficeFileDao officeFileDao;    @Resource    private UploaderHandler uploaderHandler;    @Override    protected IEntityDao<OfficeFileDto, Long> getEntityDao() {        return officeFileDao;    }    public void saveOfficeFile(Long id, String name, MultipartFile file) throws Exception{        if(null != file){            String filename = file.getOriginalFilename();            String ext = filename.substring(filename.lastIndexOf(".")+1, filename.length());            String path = FileUtil.getUploadOfficePath(filename);            //上传控件            uploaderHandler.upload(path, file.getInputStream());            //保存/更新记录            OfficeFileDto officeFileDto = null;            if(id == 0){                officeFileDto = new OfficeFileDto();                officeFileDto.setId(UniqueIdUtil.genId());                officeFileDto.setName(name);                officeFileDto.setFilename(filename);                officeFileDto.setPath(path);                officeFileDto.setExt(ext);                this.add(officeFileDto);            }else{                officeFileDto = this.getById(id);                String oldPath = officeFileDto.getPath();                officeFileDto.setName(name);                officeFileDto.setPath(path);                officeFileDto.setFilename(filename);                officeFileDto.setExt(ext);                this.update(officeFileDto);                uploaderHandler.delete(oldPath);            }        }else{            if(id != 0){                OfficeFileDto officeFileDto = this.getById(id);                officeFileDto.setName(name);                this.update(officeFileDto);            }        }    }}