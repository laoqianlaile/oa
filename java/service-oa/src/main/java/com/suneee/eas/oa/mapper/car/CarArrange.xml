<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.suneee.eas.oa.dao.car.CarArrangeDao">        <sql id="column">        `arrId`,`applyId`,`remarks`,`enterpriseCode`,`isDelete`,`informType`,        `createBy`,`createTime`,`updateBy`, `updateTime`, `refuseReason`, `procInstId`,        `taskId`    </sql>        <insert id="save" parameterType="CarArrange">        INSERT INTO oa_car_arrange        (`arrId`,`applyId`,`remarks`,`enterpriseCode`,`isDelete`,`informType`,        `createBy`,`createTime`,`updateBy`, `updateTime`, `refuseReason`,`procInstId`,        `taskId`, `mobile`)        VALUES        (#{arrId},#{applyId},#{remarks},#{enterpriseCode},#{isDelete},#{informType},        #{createBy},#{createTime},#{updateBy},#{updateTime},#{refuseReason},#{procInstId},        #{taskId},#{mobile})    </insert>    <update id="update" parameterType="CarArrange">        UPDATE oa_car_arrange        <set>            <if test="@Ognl@isNotEmpty(applyId)">                `applyId`=#{applyId},            </if>            <if test="@Ognl@isNotEmpty(remarks)">                `remarks`=#{remarks},            </if>            <if test="@Ognl@isNotEmpty(enterpriseCode)">                `enterpriseCode`=#{enterpriseCode},            </if>            <if test="@Ognl@isNotEmpty(isDelete)">                `isDelete`=#{isDelete},            </if>            <if test="@Ognl@isNotEmpty(informType)">                `informType`=#{informType},            </if>            <if test="@Ognl@isNotEmpty(createBy)">                `createBy`=#{createBy},            </if>            <if test="@Ognl@isNotEmpty(createTime)">                `createTime`=#{createTime},            </if>            <if test="@Ognl@isNotEmpty(updateBy)">                `updateBy`=#{updateBy},            </if>            <if test="@Ognl@isNotEmpty(updateTime)">                `updateTime`=#{updateTime},            </if>            <if test="@Ognl@isNotEmpty(refuseReason)">                `refuseReason`=#{refuseReason},            </if>            <if test="@Ognl@isNotEmpty(procInstId)">                `procInstId`=#{procInstId},            </if>            <if test="@Ognl@isNotEmpty(taskId)">                `taskId`=#{taskId},            </if>            <if test="@Ognl@isNotEmpty(mobile)">                `mobile`=#{mobile},            </if>        </set>        WHERE          `arrId`=#{arrId}    </update>    <delete id="deleteById" parameterType="java.lang.Long">        DELETE FROM oa_car_arrange WHERE arrId=#{arrId}    </delete>    <select id="findById" parameterType="java.lang.Long" resultType="CarArrange">        SELECT        a.arrId, a.applyId, a.remarks, a.enterpriseCode, a.isDelete, a.informType,        c.carId, c.carName, d.plateNum, c.driverId, c.driverName, b.applicantName,        b.startTime, b.endTime, b.passengerCount, b.passengerIds, b.status, b.content,        b.origin, b.destination, b.expMileage, a.createBy, a.createTime, a.updateBy,        a.updateTime, b.passengerNames, a.refuseReason,a.procInstId,a.taskId,a.mobile,        d.seatCount,d.type as carType        FROM oa_car_arrange a        LEFT JOIN oa_car_apply b ON a.applyId=b.applyId        LEFT JOIN oa_arrange_car_driver c ON a.arrId=c.arrId        LEFT JOIN oa_car_info d ON c.carId=d.carId        LEFT JOIN oa_car_driver e ON c.driverId=e.id        WHERE a.arrId = #{arrId}    </select>    <select id="list" parameterType="java.util.Map" resultType="CarArrange">        SELECT        a.arrId, a.applyId, a.remarks, a.enterpriseCode, a.isDelete, a.informType,        c.carId, c.carName, d.plateNum, c.driverId, c.driverName, b.applicantName,        b.startTime, b.endTime, b.passengerCount, b.passengerIds, b.status, b.content,        b.origin, b.destination, b.expMileage, a.createBy, a.createTime, a.updateBy,        a.updateTime, b.passengerNames, a.refuseReason,a.procInstId,a.taskId,a.mobile,        d.seatCount,d.type as carType        FROM oa_car_arrange a        LEFT JOIN oa_car_apply b ON a.applyId=b.applyId        LEFT JOIN oa_arrange_car_driver c ON a.arrId=c.arrId        LEFT JOIN oa_car_info d ON c.carId=d.carId        LEFT JOIN oa_car_driver e ON c.driverId=e.id        INNER JOIN act_ru_task rt ON rt.ID_ = a.taskId AND rt.ASSIGNEE_=#{userId}        WHERE 1=1        <if test="isProcess==true">           AND b.status=4        </if>        <if test="isProcess==false">           AND b.status=3        </if>        <if test="@Ognl@isNotEmpty(searchText)">            AND (b.applicantName LIKE CONCAT("%", #{searchText}, "%")            OR d.plateNum LIKE CONCAT("%", #{searchText}, "%")            OR c.driverName LIKE CONCAT("%", #{searchText}, "%")            OR b.destination LIKE CONCAT("%", #{searchText}, "%"))        </if>        <if test="@Ognl@isNotEmpty(status)">AND b.status=#{status} </if>        <if test="@Ognl@isNotEmpty(driverName)">AND c.driverName=#{driverName} </if>        <if test="@Ognl@isNotEmpty(applicantName)">AND b.applicantName=#{applicantName} </if>        <if test="@Ognl@isNotEmpty(status)">AND b.status=#{status} </if>        <if test="@Ognl@isNotEmpty(destination)">AND b.destination=#{destination} </if>        <if test="@Ognl@isNotEmpty(enterpriseCode)">AND a.enterpriseCode=#{enterpriseCode} </if>        <if test="@Ognl@isNotEmpty(startTime) and @Ognl@isNotEmpty(endTime)">            AND b.startTime BETWEEN #{startTime} AND #{endTime}        </if>        <if test="@Ognl@isNotEmpty(startTime) and @Ognl@isEmpty(endTime)">            AND b.startTime >= #{startTime}        </if>        <if test="@Ognl@isEmpty(startTime) and @Ognl@isNotEmpty(endTime)">            AND b.startTime <![CDATA[<= #{endTime}]]>        </if>        ORDER BY a.updateTime DESC    </select>    <select id="listAllCa" parameterType="java.util.Map" resultType="CarArrange">        SELECT        a.arrId, a.applyId, a.remarks, a.enterpriseCode, a.isDelete, a.informType,        c.carId, c.carName, d.plateNum, c.driverId, c.driverName, b.applicantName,        b.startTime, b.endTime, b.passengerCount, b.passengerIds, b.status, b.content,        b.origin, b.destination, b.expMileage, a.createBy, a.createTime, a.updateBy,        a.updateTime, b.passengerNames, a.refuseReason,a.procInstId,a.taskId,a.mobile,        d.seatCount,d.type as carType        FROM oa_car_arrange a        LEFT JOIN oa_car_apply b ON a.applyId=b.applyId        LEFT JOIN oa_arrange_car_driver c ON a.arrId=c.arrId        LEFT JOIN oa_car_info d ON c.carId=d.carId        LEFT JOIN oa_car_driver e ON c.driverId=e.id        WHERE 1=1 AND (b.status=5 or b.status=7 or b.status=8)        <if test="@Ognl@isNotEmpty(searchText)">            AND (b.applicantName LIKE CONCAT("%", #{searchText}, "%")            OR d.plateNum LIKE CONCAT("%", #{searchText}, "%")            OR c.driverName LIKE CONCAT("%", #{searchText}, "%")            OR b.destination LIKE CONCAT("%", #{searchText}, "%"))        </if>        <if test="@Ognl@isNotEmpty(status)">AND b.status=#{status} </if>        <if test="@Ognl@isNotEmpty(driverName)">AND c.driverName=#{driverName} </if>        <if test="@Ognl@isNotEmpty(applicantName)">AND b.applicantName=#{applicantName} </if>        <if test="@Ognl@isNotEmpty(status)">AND b.status=#{status} </if>        <if test="@Ognl@isNotEmpty(destination)">AND b.destination=#{destination} </if>        <if test="@Ognl@isNotEmpty(enterpriseCode)">AND a.enterpriseCode=#{enterpriseCode} </if>        <if test="@Ognl@isNotEmpty(carId)">AND d.carId=#{carId} </if>        <if test="@Ognl@isNotEmpty(startTime) and @Ognl@isNotEmpty(endTime)">            AND b.startTime BETWEEN #{startTime} AND #{endTime}        </if>        <if test="@Ognl@isNotEmpty(startTime) and @Ognl@isEmpty(endTime)">            AND b.startTime >= #{startTime}        </if>        <if test="@Ognl@isEmpty(startTime) and @Ognl@isNotEmpty(endTime)">            AND b.startTime <![CDATA[<= #{endTime}]]>        </if>        ORDER BY a.updateTime DESC    </select>    <update id="updateTaskId" parameterType="java.util.Map">        UPDATE          oa_car_arrange        SET          taskId = #{taskId}        WHERE          applyId = #{applyId}    </update>    <select id="findByApplyId" parameterType="java.lang.Long" resultType="CarArrange">        SELECT        a.arrId, a.applyId, a.remarks, a.enterpriseCode, a.isDelete, a.informType,        c.carId, c.carName, d.plateNum, c.driverId, c.driverName, b.applicantName,        b.startTime, b.endTime, b.passengerCount, b.passengerIds, b.status, b.content,        b.origin, b.destination, b.expMileage, a.createBy, a.createTime, a.updateBy,        a.updateTime, b.passengerNames, a.refuseReason,a.procInstId,a.taskId,a.mobile,        d.seatCount,d.type as carType        FROM oa_car_arrange a        LEFT JOIN oa_car_apply b ON a.applyId=b.applyId        LEFT JOIN oa_arrange_car_driver c ON a.arrId=c.arrId        LEFT JOIN oa_car_info d ON c.carId=d.carId        LEFT JOIN oa_car_driver e ON c.driverId=e.id        WHERE a.applyId = #{applyId}    </select>    <delete id="deleteByApplyId" parameterType="java.lang.Long">        DELETE FROM oa_car_arrange WHERE applyId=#{applyId}    </delete></mapper>