package com.suneee.eas.oa.controller.car;import com.suneee.eas.common.component.Pager;import com.suneee.eas.common.component.QueryFilter;import com.suneee.eas.common.component.ResponseMessage;import com.suneee.eas.common.constant.FunctionConstant;import com.suneee.eas.common.constant.ModuleConstant;import com.suneee.eas.common.utils.ContextSupportUtil;import com.suneee.eas.common.utils.DateUtil;import com.suneee.eas.common.utils.RequestUtil;import com.suneee.eas.common.utils.StringUtil;import com.suneee.eas.oa.model.car.CarAuditHistory;import com.suneee.eas.oa.service.car.CarAuditHistoryService;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import javax.servlet.http.HttpServletRequest;import java.util.List;/** * @program: eas-parent * @description: 审批历史 * @author: liuhai * @create: 2018-10-23 15:57 **/@Controller@RequestMapping(ModuleConstant.CAR_MODULE+ FunctionConstant.CAR_AUDIT_HISTORY)public class CarAuditHistoryApiController {    private static final Logger logger = LogManager.getLogger(CarAuditHistoryApiController.class);    @Autowired    private CarAuditHistoryService carAuditHistoryService;    @RequestMapping("listPage")    @ResponseBody    public ResponseMessage listPage(HttpServletRequest request){        try {            String startTime = RequestUtil.getString(request, "beginUseTime");            String endTime = RequestUtil.getString(request, "endUseTime");            String beginCreateTime = RequestUtil.getString(request, "beginCreateTime");            String endCreateTime = RequestUtil.getString(request, "endCreateTime");            QueryFilter filter=new QueryFilter("listPage",request);            if(StringUtil.isNotEmpty(startTime)){                filter.addFilter("beginUseTime", DateUtil.getDate(startTime));            }            if(StringUtil.isNotEmpty(endTime)){                filter.addFilter("endUseTime" , DateUtil.getDate(endTime));            }            if(StringUtil.isNotEmpty(beginCreateTime)){                filter.addFilter("beginCreateTime" , DateUtil.getDate(beginCreateTime));            }            if(StringUtil.isNotEmpty(endCreateTime)){                filter.addFilter("endCreateTime" , DateUtil.getDate(endCreateTime));            }            String enterpriseCode = ContextSupportUtil.getCurrentEnterpriseCode();            filter.addFilter("enterpriseCode", enterpriseCode);            filter.addFilter("userId", ContextSupportUtil.getCurrentUserId());            Pager<CarAuditHistory> list = carAuditHistoryService.getPageBySqlKey(filter);            return ResponseMessage.success("获取审批历史分页列表成功。", list);        } catch (Exception e) {            logger.error("获取审批历史分页列表失败:" + e.getMessage(), e);            return ResponseMessage.fail("获取审批历史分页列表失败！"+e.getMessage(), e);        }    }    @RequestMapping("list")    @ResponseBody    public ResponseMessage list(HttpServletRequest request){        try {            String startTime = RequestUtil.getString(request, "startTime");            String endTime = RequestUtil.getString(request, "endTime");            QueryFilter queryFilter = new QueryFilter("listPage", request);            if(StringUtil.isNotEmpty(startTime)){                queryFilter.addFilter("startTime", DateUtil.getDate(startTime));            }            if(StringUtil.isNotEmpty(endTime)){                queryFilter.addFilter("endTime" , DateUtil.getDate(endTime));            }            String enterpriseCode = ContextSupportUtil.getCurrentEnterpriseCode();            queryFilter.addFilter("enterpriseCode", enterpriseCode);            List<CarAuditHistory> list = carAuditHistoryService.getListBySqlKey(queryFilter);            return ResponseMessage.success("获取审批历史列表成功。", list);        } catch (Exception e) {            logger.error("获取审批历史列表失败:" + e.getMessage(), e);            return ResponseMessage.fail("获取审批历史列表失败！"+e.getMessage(), e);        }    }    /**     * 获取车辆安排详情     * @param request     * @return     */    @RequestMapping("findById")    @ResponseBody    public ResponseMessage findById(HttpServletRequest request){        Long id = RequestUtil.getLong(request, "id");        if(id == 0){            logger.error("获取审批历史失败，参数不能为空！");            return ResponseMessage.fail("获取审批历史失败，参数不能为空！");        }        try {            CarAuditHistory carAuditHistory = carAuditHistoryService.findById(id);            return ResponseMessage.success("查询详情成功。", carAuditHistory);        } catch (Exception e) {            logger.error("查询详情失败："+e.getMessage(), e);            return ResponseMessage.fail("查询详情失败！"+ e.getMessage(), e);        }    }}